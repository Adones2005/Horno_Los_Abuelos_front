<section class="p-4 sm:p-6 lg:p-8 xl:p-10">
  <!-- Cabecera + botón “Añadir” -->
  <div class="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <h1 class="text-2xl font-semibold">Catálogo interno</h1>

    <button
      (click)="abrirForm()"
      class="rounded-full bg-[#E5D2BC] px-4 py-2 text-sm font-medium text-gray-800 transition hover:bg-[#d9c0a9]"
    >
      + Nuevo producto
    </button>
  </div>

  <form
    *ngIf="showForm()"
    [formGroup]="form"
    (ngSubmit)="submit()"
    class="mb-8 grid gap-4 rounded-2xl bg-white p-6 shadow-sm md:grid-cols-3"
  >
    <input type="hidden" formControlName="id" />

    <div class="space-y-1">
      <label class="text-sm font-medium">Nombre</label>
      <input
        formControlName="nombre"
        class="w-full rounded border border-gray-300 p-2 text-sm focus:ring-[#E5D2BC]"
      />
    </div>

    <div class="space-y-1">
      <label class="text-sm font-medium">Precio (€)</label>
      <input
        type="number"
        formControlName="precio"
        step="0.01"
        class="w-full rounded border border-gray-300 p-2 text-sm focus:ring-[#E5D2BC]"
      />
    </div>

    <!-- Especificaciones (checkbox-cards) -->
<div class="space-y-1 md:col-span-3">
  <label class="text-sm font-medium">Especificaciones</label>

  <div
    class="grid gap-2
           grid-cols-2 sm:grid-cols-3 lg:grid-cols-4"
  >
    <label
      *ngFor="let e of especificaciones$ | async"
      class="cursor-pointer"
    >
      <!-- checkbox invisible -->
      <input
        type="checkbox"
        class="peer sr-only"
        [value]="e.id"
        [checked]="seleccion.has(e.id)"
      />

      <!-- tarjeta -->
      <div
        class="flex h-full items-center justify-center rounded-lg border
               border-gray-300 bg-white p-3 text-center text-sm transition
               peer-checked:border-[#E5D2BC] peer-checked:bg-[#F7F3EF]"
      >
        {{ e.descripcion }}
      </div>
    </label>
  </div>

  <p class="text-xs text-gray-500">
    Marca todas las que apliquen.
  </p>
</div>



    <div class="space-y-1 md:col-span-1">
    <label class="text-sm font-medium">Imagen (PNG / JPG / WEBP)</label>


    <input
        type="file"
        accept=".png,.jpg,.jpeg,.webp"
        (change)="onFileSelected($event)"
        class="w-full cursor-pointer rounded border border-gray-300 p-2 text-sm file:mr-4 file:rounded-full file:border-0 file:bg-[#E5D2BC] file:px-3 file:py-1 file:text-sm file:font-medium file:text-gray-800 hover:file:bg-[#d9c0a9]"
    />

    <p *ngIf="imgError" class="text-xs text-red-500">{{ imgError }}</p>
    </div>


    <div class="md:col-span-3 flex gap-3">
      <button
        type="submit"
        [disabled]="loading || form.invalid"
        class="flex-1 rounded-full bg-[#E5D2BC] py-2 text-center font-medium text-gray-800 transition hover:bg-[#d9c0a9] disabled:opacity-50"
      >
        {{ form.get('id')?.value ? 'Guardar cambios' : 'Crear pastel' }}
      </button>
      <button
        type="button"
        (click)="showForm.set(false)"
        class="flex-1 rounded-full bg-gray-100 py-2 text-center text-sm text-gray-600 hover:bg-gray-200"
      >
        Cancelar
      </button>
    </div>
  </form>


  <p *ngIf="errorMsg" class="mb-4 rounded bg-red-100 p-4 text-red-700">
    {{ errorMsg }}
  </p>


  <div
    *ngIf="pasteles$ | async as pasteles"
    class="grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3"
  >
    <div
      *ngFor="let p of pasteles"
      class="flex overflow-hidden rounded-2xl bg-white shadow-sm transition hover:shadow-md"
    >

      <img
        [src]="apiUrl + '/images/' + p.imagen"
        [alt]="p.nombre"
        class="h-28 w-28 flex-none object-cover"
      />


      <div class="flex flex-1 flex-col justify-between p-4">
        <div>
          <h3 class="break-words text-sm font-semibold text-gray-800">
            {{ p.nombre }}
          </h3>
          <p class="text-[#B9A99B] text-sm">
            {{ p.precio | currency:'EUR':'symbol' }} / unidad
          </p>
        </div>

        <div class="mt-3 flex gap-2">
          <button
            (click)="edit(p)"
            class="flex-1 rounded-full bg-blue-50 py-1 text-xs font-medium text-blue-600 hover:bg-blue-100"
          >
            Editar
          </button>
          <button
            (click)="eliminar(p.id)"
            class="flex-1 rounded-full bg-red-50 py-1 text-xs font-medium text-red-600 hover:bg-red-100"
          >
            Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>
</section>
